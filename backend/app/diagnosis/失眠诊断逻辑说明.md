# 失眠诊断系统逻辑说明

## 1. 特殊流程控制

### 提前退出流程
| 触发条件 | 处理逻辑 | 结果 |
|----------|----------|------|
| 第1题选择"好" | 直接完成测评 | 显示祝福信息，退出评测流程 |
| 第9题选择"3个月以上" | 建议专业咨询 | 推荐高级咨询师定制流程 |

### 跳题逻辑
| 条件 | 跳题行为 | 说明 |
|------|----------|------|
| 第8题选择"无" | 跳过第9题 | 未使用安眠药无需询问用药时长 |
| 第8题选择任一药物 | 显示第9题 | 需要了解用药时长制定方案 |

## 2. 评分系统（1-8题，第9题不参与评分）

### 基础评分规则
| 题目 | 类型 | 评分规则 | 说明 |
|------|------|----------|------|
| 第1题 | 单选 | 20, 10, 0 | 睡眠状况 |
| 第2题 | 单选 | 12, 9, 6, 3, 0 | 入睡时间 |
| 第3题 | 单选 | 12, 9, 6, 3, 0 | 睡眠时长 |
| 第4题 | 单选 | 9, 6, 3, 0 | 醒来次数 |
| 第5题 | 单选 | 12, 9, 6, 3, 0 | 再入睡时间 |
| 第6题 | 单选 | 9, 6, 3, 0 | 白天嗜睡 |
| 第7题 | 多选 | 每选一项减3分 | 睡眠困扰（可选"无"不减分） |
| 第8题 | 多选 | 每选一项减5分 | 安眠药物（可选"无"不减分） |
| 第9题 | 单选 | **不参与评分** | 仅供治疗方案参考 |

### 失眠等级划分
| 分数区间 | 等级 | 建议 | 说明 |
|----------|------|------|------|
| ≥103分 | 无需治疗 | 保持现状 | 睡眠质量良好 |
| 74分 | 初级失眠 | 保持 | 轻微失眠，使用茶包1 |
| 60-73分 | 初级失眠 | 茶包3+奶粉 | 需要食疗调理 |
| 45-59分 | 中级失眠 | 奶粉+营养+理疗 | 需要综合治疗 |
| ≤44分 | 高级失眠 | 定制流程 | 严重失眠，需专业治疗 |

## 2. 证型分析系统（10-19题）

### 证型计分配置
证型分为**主证型（行）**和**次证型（列）**，形成3×2矩阵：

#### 主证型（行）- 用于食疗选择
- **肝肠证型**：第10题 + 第15题
- **血液证型**：第11题 + 第16题  
- **神内证型**：第12题 + 第17题

#### 次证型（列）- 用于营养搭配
- **骨髓证型**：第13题 + 第18题
- **脑髓证型**：第14题 + 第19题

### 证型矩阵组合（6种）
```
        骨髓      脑髓
肝肠   肝郁肾虚   肝郁脑虚
血液   气血两虚   气滞血瘀  
神内   精髓空虚   神经衰弱
```

**诊断逻辑**：
1. 行取最高分（主证型）
2. 列取最高分（次证型）  
3. 矩阵交叉得出最终证型

## 3. 治疗方案配置

### 食疗逻辑（茶包选择）
**规则**：看肝肠、血液、神内哪个得分最高

| 最高分证型 | 茶包选择 | 适用人群 |
|------------|----------|----------|
| 肝肠得分最高 | 茶包3(养肝) | 情绪压力大、肝气郁滞 |
| 血液得分最高 | 茶包3(养血) | 气血不足、面色萎黄 |
| 神内得分最高 | 茶包3(养神) | 精神紧张、神经衰弱 |

### 营养补充逻辑（中级失眠45-59分）
**规则**：根据次证型（骨髓/脑髓）选择营养补充

| 次证型类别 | 营养搭配 | 说明 |
|------------|----------|------|
| 骨髓类证型 | 奶粉 + 坚果 | 补肾填髓，强筋骨 |
| 脑髓类证型 | 奶粉 + 鱼油 | 健脑益智，养脑髓 |

### 穴位理疗逻辑（6种证型对应不同穴位）
**规则**：根据最终证型组合选择专门穴位

| 证型组合 | 穴位组合 | 治疗原理 |
|----------|----------|----------|
| 肝郁肾虚 | 肝俞、肾俞、太冲、太溪 | 疏肝补肾 |
| 肝郁脑虚 | 肝俞、百会、神门、印堂 | 疏肝健脑 |
| 气血两虚 | 脾俞、胃俞、足三里、血海 | 健脾养血 |
| 气滞血瘀 | 心俞、神门、内关、三阴交 | 理气活血 |
| 精髓空虚 | 肾俞、命门、关元、涌泉 | 补肾填精 |
| 神经衰弱 | 百会、神庭、安眠、神门 | 安神定志 |

## 4. 完整治疗方案示例

### 示例1：初级失眠患者
**基本信息**：
- 基础评分：65分
- 证型得分：肝肠8分，血液6分，神内4分  
- 最终证型：肝郁肾虚（肝肠最高 + 骨髓最高）

**治疗方案**：
- 等级：初级失眠(60-73分)
- 食疗：茶包3(养肝) + 奶粉（肝肠得分最高）
- 理疗：无（初级失眠不需要）

### 示例2：中级失眠患者
**基本信息**：
- 基础评分：50分
- 证型得分：血液7分，肝肠5分，神内3分
- 最终证型：气血两虚（血液最高 + 骨髓最高）

**治疗方案**：
- 等级：中级失眠(45-59分)  
- 食疗：奶粉 + 坚果（骨髓类证型）
- 理疗：穴位敷贴（脾俞、胃俞、足三里、血海）

## 5. 特殊处理示例

### 示例1：睡眠质量很好的用户
**触发条件**：第1题选择"好"  
**系统响应**：
- 等级：无需治疗
- 消息："恭喜您！您的睡眠质量很好，请继续保持良好的作息习惯。祝您身体健康！"
- 产品：无推荐
- 后续：直接退出评测流程

### 示例2：长期用药的严重用户  
**触发条件**：第9题选择"3个月以上"
**系统响应**：
- 等级：长期用药失眠
- 消息："您长期使用安眠药物，建议寻求高级咨询师的专业指导，制定个性化的减药和治疗方案。"
- 推荐：专业咨询服务 + 高级咨询师定制流程
- 后续：引导至人工咨询

### 示例3：未使用安眠药的用户
**触发条件**：第8题选择"无"
**系统行为**：自动跳过第9题，继续正常评测流程

## 6. 系统特点

### 智能流程控制
1. **提前识别**：第1题即可识别优质睡眠用户
2. **条件跳题**：根据第8题答案决定是否显示第9题
3. **风险预警**：长期用药用户直接推荐专业咨询

### 双重逻辑设计
1. **食疗选择**：基于主证型得分（肝血神）
2. **穴位理疗**：基于证型组合（6种）
3. **营养搭配**：基于次证型（骨髓/脑髓）

### 个性化精准
- 每个患者都有独特的证型组合
- 食疗、营养、理疗三位一体
- 分层治疗，循序渐进
- 特殊情况特殊处理

### 中医理论基础
- 基于传统中医辨证论治
- 结合现代失眠评估标准
- 证型矩阵科学分类
- 人性化用户体验

---

*本文档记录了失眠诊断系统的完整逻辑，包括评分规则、证型分析、治疗方案配置等核心算法。*